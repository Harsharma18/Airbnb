<% layout("/layouts/boilerplate") %>
<link href="/css/new.css" rel="stylesheet" />

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-6">
      <div class="card shadow-lg p-4">
        <h3 class="text-center mb-4">Create a New Listing</h3>
        <form
          method="post"
          action="/listings"
          novalidate
          class="needs-validation"
          enctype="multipart/form-data"
        >
          <!-- Title Input -->
          <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input
              name="listing[title]"
              placeholder="Enter title"
              type="text"
              class="form-control"
              required
            />
            <div class="invalid-feedback">Please enter a title</div>
            <div class="valid-feedback">Great title! ‚ú®</div>
          </div>

          <!-- Description Input -->
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea
              name="listing[description]"
              placeholder="Enter description"
              class="form-control"
              required
            ></textarea>
            <div class="invalid-feedback">Please enter a short description</div>
            <div class="valid-feedback">Nice description! üìù</div>
          </div>

          <!-- Image Upload -->
          <div class="mb-3">
            <label for="image" class="form-label">Upload Listing Image</label>
            <input
              id="inputfile"
              name="listing[image]"
              type="file"
              class="form-control"
              required
            />
            <div id="error-message" class="text-danger mt-2"></div>
          </div>
          <div class="mb-3">
            <p class="card-title"><b>Image Preview</b></p>
            <img
              class="shadow-lg bg-body rounded border border-3 rounded-top"
              id="imagePreview"
              src="/icons/imgpreview.png"
              alt="Preview"
            />
          </div>

          <div class="mb-3">
            <label for="category" class="form-label"
              ><b>Choose Category</b></label
            >
            <div
              class="category-choose d-flex flex-wrap align-items-center gap-3 p-3 border rounded bg-light shadow-sm"
            >
              <div class="d-flex align-items-center gap-2">
                <span class="badge bg-primary text-white px-3 py-2 rounded-pill"
                  >Single Choose</span
                >
                <span class="text-secondary fw-semibold">Click</span>
              </div>
              <div class="d-none d-md-block vr"></div>
              <div class="d-flex align-items-center gap-2">
                <span class="badge bg-success text-white px-2 py-2 rounded-pill"
                  >Multiple Choose</span
                >
                <span class="text-secondary fw-semibold"
                  >Hold
                  <kbd class="bg-dark text-white px-2 py-1 rounded">Ctrl</kbd> +
                  Click</span
                >
              </div>
            </div>

            <select
              id="category"
              name="listing[category]"
              size="2"
              class="form-select border border-black border-opacity-50 mb-2"
              multiple
              required
              style="font-size: 0.95rem"
            >
              <option value="Beachfront">Beachfront</option>
              <option value="Cabins">Cabins</option>
              <option value="Omg">OMG</option>
              <option value="Lake">Lake</option>
              <option value="Design">Design</option>
              <option value="Amazing Pools">Amazing pools</option>
              <option value="Farms">Farms</option>
              <option value="Amazing Views">Amazing views</option>
              <option value="Rooms">Rooms</option>
              <option value="Lakefront">Lakefront</option>
              <option value="Tiny Homes">Tiny homes</option>
              <option value="Countryside">Countryside</option>
              <option value="Treehouse">Treehouse</option>
              <option value="Trending">Trending</option>
              <option value="Tropical">Tropical</option>
              <option value="National Parks">National parks</option>
              <option value="Casties">Casties</option>
              <option value="Camping">Camping</option>
              <option value="Top Of The World">Top of the world</option>
              <option value="Luxe">Luxe</option>
              <option value="Iconic Cities">Iconic cities</option>
              <option value="Earth Homes">Earth homes</option>
            </select>
            <div class="invalid-feedback">Choose category name</div>
          </div>
          <!-- Price and Location (Horizontal Layout) -->
          <div class="row">
            <div class="mb-3 col-md-6">
              <label for="price" class="form-label">Price</label>
              <input
                name="listing[price]"
                placeholder="1200"
                class="form-control"
                required
              />
              <div class="invalid-feedback">Please enter a price</div>
              <div class="valid-feedback">
                Great choice! Your price is just right! üí∏
              </div>
            </div>
            <div class="mb-3 col-md-6">
              <label for="location" class="form-label">Location</label>
              <input
                name="listing[location]"
                placeholder="Bhiwani, Haryana"
                type="text"
                class="form-control"
                required
              />
              <div class="invalid-feedback">Please enter the location</div>
              <div class="valid-feedback">Location added! üìç</div>
            </div>
          </div>

          <!-- Country Input -->
          <div class="mb-3">
            <label for="country" class="form-label">Country</label>
            <input
              name="listing[country]"
              placeholder="India"
              type="text"
              class="form-control"
              required
            />
            <div class="invalid-feedback">Please enter a country name</div>
            <div class="valid-feedback">Country noted! üåè</div>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button class="btn btn-primary btn-lg mt-3 px-3">
              Add Listing
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- </div>
<script>
    const inputFile = document.getElementById('inputfile');
    const imagePreview = document.getElementById('imagePreview');
  
    inputFile.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const objectURL = URL.createObjectURL(file);
        imagePreview.src = objectURL;
  
        // Revoke the object URL after the image has loaded
        imagePreview.onload = () => {
          URL.revokeObjectURL(objectURL);
        };
      }
    });
  </script> -->
  <script>
    document
      .getElementById("inputfile")
      .addEventListener("change", function (e) {
        const file = e.target.files[0];
        const errorMessage = document.getElementById("error-message");
        const imagePreview = document.getElementById("imagePreview");

        if (file) {
          if (file.size > 200 * 1024) {
            // 200KB
            errorMessage.textContent =
              "File size exceeds 200KB. Please upload a smaller image.";
            imagePreview.src = "/icons/imgpreview.png"; // Reset to default preview
            e.target.value = ""; // Clear the input
          } else {
            errorMessage.textContent = "";
            const objectURL = URL.createObjectURL(file);
            imagePreview.src = objectURL;

            imagePreview.onload = () => {
              URL.revokeObjectURL(objectURL);
            };
          }
        }
      });
  </script>
</div>
